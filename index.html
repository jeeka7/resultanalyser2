<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Student Marks Analyzer</title>
    <style>
        body {
            font-family: Arial, sans-serif;
            text-align: center;
            margin-top: 30px;
        }
        table {
            margin: 20px auto;
            border-collapse: collapse;
            width: 80%;
        }
        th, td {
            border: 1px solid black;
            padding: 10px;
            text-align: center;
        }
        th {
            background-color: #f2f2f2;
        }
        .highlight {
            background-color: yellow;
        }
        .input-section {
            margin-bottom: 20px;
        }
        .category-table {
            margin-top: 40px;
        }
        .download-btn {
            margin-top: 20px;
        }
    </style>
</head>
<body>
    <h1>Student Marks Analyzer</h1>

    <!-- Input Section -->
    <div class="input-section">
        <label for="subject">Subject:</label>
        <input type="text" id="subject" placeholder="Enter Subject">
        <br><br>
        <label for="numStudents">Number of Students (Max 70):</label>
        <input type="number" id="numStudents" min="1" max="70" placeholder="Enter number of students">
        <br><br>
        <label for="passingMarks">Passing Marks:</label>
        <input type="number" id="passingMarks" placeholder="Enter Passing Marks">
        <br><br>
        <button onclick="generateInputFields()">Generate Input Fields</button>
    </div>

    <!-- Dynamic Input Fields -->
    <div id="dynamicInputs"></div>

    <!-- Process Button -->
    <button onclick="processData()">Process</button>

    <!-- Analysis Tables -->
    <h2>Student Results</h2>
    <table id="resultsTable">
        <thead>
            <tr>
                <th>Roll Number</th>
                <th>Marks</th>
                <th>Percentage</th>
                <th>Percentile</th>
                <th>Status</th>
            </tr>
        </thead>
        <tbody>
            <!-- Results will be dynamically inserted here -->
        </tbody>
    </table>

    <h2>Category Analysis</h2>
    <table id="categoryTable" class="category-table">
        <thead>
            <tr>
                <th>Category (Percentage Range)</th>
                <th>Number of Students</th>
            </tr>
        </thead>
        <tbody>
            <!-- Category analysis will be dynamically inserted here -->
        </tbody>
    </table>

    <!-- QPI Display -->
    <h2>QPI: <span id="qpi"></span></h2>

    <!-- Download Buttons -->
    <div class="download-btn">
        <button onclick="downloadPDF()">Download as PDF</button>
    </div>

    <script>
        function generateInputFields() {
            const numStudents = document.getElementById('numStudents').value;
            const dynamicInputs = document.getElementById('dynamicInputs');
            dynamicInputs.innerHTML = ''; // Clear previous inputs

            if (!numStudents || numStudents <= 0 || numStudents > 70) {
                alert("Please enter a valid number of students (1 to 70).");
                return;
            }

            for (let i = 1; i <= numStudents; i++) {
                dynamicInputs.innerHTML += `
                    <div>
                        <label for="roll${i}">Roll Number ${i}:</label>
                        <input type="text" id="roll${i}" placeholder="Enter Roll Number">
                        <label for="marks${i}">Marks ${i}:</label>
                        <input type="number" id="marks${i}" placeholder="Enter Marks">
                    </div>
                `;
            }
        }

        function processData() {
            const subject = document.getElementById('subject').value.trim();
            const numStudents = document.getElementById('numStudents').value;
            const passingMarks = parseInt(document.getElementById('passingMarks').value, 10);
            const students = [];

            if (!subject || !passingMarks || numStudents <= 0) {
                alert("Please enter valid details for subject, passing marks, and number of students.");
                return;
            }

            for (let i = 1; i <= numStudents; i++) {
                const roll = document.getElementById(`roll${i}`).value.trim();
                const marks = parseInt(document.getElementById(`marks${i}`).value, 10);

                if (roll && !isNaN(marks)) {
                    students.push({ roll, marks });
                }
            }

            if (students.length === 0) {
                alert("Please enter valid roll numbers and marks for all students.");
                return;
            }

            // Calculate total marks, average, highest marks and QPI
            const totalMarks = students.reduce((sum, student) => sum + student.marks, 0);
            const averageMarks = totalMarks / students.length;
            const highestMarks = Math.max(...students.map(student => student.marks));
            const qpi = (totalMarks / students.length).toFixed(2);

            // Calculate percentages and percentiles
            students.forEach(student => {
                student.percentage = (student.marks / 100) * 100; // Assuming full marks are 100
            });
            students.sort((a, b) => a.marks - b.marks);
            students.forEach((student, index) => {
                student.percentile = ((index + 1) / students.length * 100).toFixed(2);
            });

            // Categorize students based on percentage
            const categories = [
                { range: "0% - 33%", count: 0 },
                { range: "33% - 45%", count: 0 },
                { range: "45% - 60%", count: 0 },
                { range: "60% - 75%", count: 0 },
                { range: "75% - 80%", count: 0 },
                { range: "80% - 85%", count: 0 },
                { range: "85% - 90%", count: 0 },
                { range: "90% - 99%", count: 0 },
                { range: "100%", count: 0 }
            ];

            students.forEach(student => {
                const percentage = student.percentage;
                if (percentage <= 33) categories[0].count++;
                else if (percentage <= 45) categories[1].count++;
                else if (percentage <= 60) categories[2].count++;
                else if (percentage <= 75) categories[3].count++;
                else if (percentage <= 80) categories[4].count++;
                else if (percentage <= 85) categories[5].count++;
                else if (percentage <= 90) categories[6].count++;
                else if (percentage < 100) categories[7].count++;
                else categories[8].count++;
            });

            // Populate results table
            const resultsTableBody = document.querySelector('#resultsTable tbody');
            resultsTableBody.innerHTML = '';
            students.forEach(student => {
                const status = student.marks >= passingMarks ? "Pass" : "Compartment";
                const row = `<tr>
                    <td>${student.roll}</td>
                    <td>${student.marks}</td>
                    <td>${student.percentage.toFixed(2)}%</td>
                    <td>${student.percentile}%</td>
                    <td>${status}</td>
                </tr>`;
                resultsTableBody.innerHTML += row;
            });

            // Populate category table
            const categoryTableBody = document.querySelector('#categoryTable tbody');
            categoryTableBody.innerHTML = '';
            categories.forEach(category => {
                const row = `<tr>
                    <td>${category.range}</td>
                    <td>${category.count}</td>
                </tr>`;
                categoryTableBody.innerHTML += row;
            });

            // Display QPI
            document.getElementById('qpi').textContent = qpi;
        }

        function downloadPDF() {
            alert("PDF functionality can be added similarly to the earlier version.");
        }
    </script>
</body>
</html>
